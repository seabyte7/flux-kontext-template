# FluxKontext SaaS åŸºç¡€è®¾æ–½å®æ–½å®¡è®¡æŠ¥å‘Š

> **å®¡è®¡æ—¥æœŸ**: 2026-02-08
> **å®¡è®¡èŒƒå›´**: `docs/SAAS_GAP_ANALYSIS.md` ç¬¬ä¸€é˜¶æ®µå…¨éƒ¨ 6 é¡¹ + ç¬¬äºŒé˜¶æ®µ 3 é¡¹ï¼ˆå…± 8 ä¸ªä»»åŠ¡ï¼‰
> **åŸºå‡†æ–‡æ¡£**: `docs/SAAS_GAP_ANALYSIS.md`

---

## æ€»è§ˆ

| ä»»åŠ¡ | æ¨¡å— | è´Ÿè´£äºº | çŠ¶æ€ | å®¡è®¡ç»“æœ |
|------|------|--------|------|----------|
| #1 | Vitest æµ‹è¯•ä½“ç³» | developer | completed | âœ… é€šè¿‡ |
| #2 | Sentry é”™è¯¯ç›‘æ§ | qa | in_progress | âŒ æœªå®æ–½ |
| #3 | GitHub Actions CI/CD | developer | completed | âœ… é€šè¿‡ |
| #4 | Resend é‚®ä»¶ç³»ç»Ÿ | designer | completed | âœ… é€šè¿‡ |
| #5 | t3-env ç¯å¢ƒå˜é‡æ ¡éªŒ | designer | completed | âœ… é€šè¿‡ |
| #6 | å¥åº·æ£€æŸ¥ç«¯ç‚¹ | designer | completed | âœ… é€šè¿‡ |
| #7 | Pino æ—¥å¿— + Upstash é€Ÿç‡é™åˆ¶ | security | completed | âœ… é€šè¿‡ |
| #8 | ç®¡ç†åå°é¢æ¿ | designer | completed | âœ… é€šè¿‡ |

**æ€»ä½“å®Œæˆç‡**: 7/8 æ¨¡å—é€šè¿‡ï¼ˆ87.5%ï¼‰ï¼Œ1 ä¸ªæ¨¡å—æœªå®æ–½

---

## é€æ¨¡å—å®¡è®¡è¯¦æƒ…

### Task #1 â€” Vitest æµ‹è¯•ä½“ç³»

**å®¡è®¡ç»“æœ: âœ… é€šè¿‡**

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| æ¡†æ¶é…ç½® | âœ… | `vitest.config.ts` é…ç½®å®Œæ•´ |
| æµ‹è¯•ç¯å¢ƒ | âœ… | jsdom ç¯å¢ƒï¼Œglobals å¯ç”¨ |
| è·¯å¾„åˆ«å | âœ… | `@/` â†’ `./src` æ˜ å°„æ­£ç¡® |
| è¦†ç›–ç‡é…ç½® | âœ… | v8 providerï¼Œè¦†ç›– `src/lib/**/*.ts` |
| Setup æ–‡ä»¶ | âœ… | `src/__tests__/setup.ts` å­˜åœ¨ |
| æµ‹è¯•ç”¨ä¾‹ | âœ… | 3 ä¸ªæµ‹è¯•æ–‡ä»¶ |

**å·²åˆ›å»ºçš„æ–‡ä»¶**:
- `vitest.config.ts` â€” jsdom ç¯å¢ƒ + v8 è¦†ç›–ç‡ + `@/` è·¯å¾„åˆ«å
- `src/__tests__/setup.ts` â€” æµ‹è¯•åˆå§‹åŒ–
- `src/__tests__/user-tiers.test.ts` â€” ç”¨æˆ·åˆ†å±‚é€»è¾‘æµ‹è¯•
- `src/__tests__/credits.test.ts` â€” ç§¯åˆ†ç³»ç»Ÿæµ‹è¯•
- `src/__tests__/payment-security.test.ts` â€” æ”¯ä»˜å®‰å…¨æµ‹è¯•

**æ³¨æ„äº‹é¡¹**:
- å½“å‰æµ‹è¯•è¦†ç›–é›†ä¸­åœ¨æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆç§¯åˆ†/æ”¯ä»˜/ç”¨æˆ·åˆ†å±‚ï¼‰ï¼Œæœªè¦†ç›– API è·¯ç”±å’Œç»„ä»¶
- æ—  E2E æµ‹è¯•ï¼ˆPlaywrightï¼‰ï¼Œå»ºè®®åç»­è¡¥å……
- CI æµæ°´çº¿å·²é›†æˆ `pnpm test` å‘½ä»¤

---

### Task #2 â€” Sentry é”™è¯¯ç›‘æ§

**å®¡è®¡ç»“æœ: âŒ æœªå®æ–½**

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| ä¾èµ–å®‰è£… | âš ï¸ | `@sentry/nextjs` å·²å®‰è£…ä½†æœªéªŒè¯ç‰ˆæœ¬ |
| Client é…ç½® | âŒ | `sentry.client.config.ts` ä¸å­˜åœ¨ |
| Server é…ç½® | âŒ | `sentry.server.config.ts` ä¸å­˜åœ¨ |
| Edge é…ç½® | âŒ | `sentry.edge.config.ts` ä¸å­˜åœ¨ |
| Global Error | âŒ | `src/app/global-error.tsx` ä¸å­˜åœ¨ |
| Next.js é›†æˆ | âŒ | `next.config` æœªåŒ…è£¹ `withSentryConfig` |
| ç¯å¢ƒå˜é‡ | âŒ | `SENTRY_DSN` æœªåœ¨ `env.ts` ä¸­å®šä¹‰ |

**é—®é¢˜**: ä»…å®‰è£…äº† npm ä¾èµ–ï¼Œæœªåˆ›å»ºä»»ä½•é…ç½®æ–‡ä»¶ã€‚ä»»åŠ¡æ ‡è®°ä¸º `in_progress` ä½†å®é™…æ— äº§å‡ºç‰©ã€‚

**éœ€è¡¥å……çš„æ–‡ä»¶**:
1. `sentry.client.config.ts` â€” æµè§ˆå™¨ç«¯ Sentry åˆå§‹åŒ–
2. `sentry.server.config.ts` â€” Node.js ç«¯ Sentry åˆå§‹åŒ–
3. `sentry.edge.config.ts` â€” Edge Runtime Sentry åˆå§‹åŒ–
4. `src/app/global-error.tsx` â€” Next.js å…¨å±€é”™è¯¯è¾¹ç•Œ
5. `src/instrumentation.ts` â€” Next.js instrumentation hook
6. ä¿®æ”¹ `next.config.ts` â€” æ·»åŠ  `withSentryConfig` åŒ…è£¹
7. ä¿®æ”¹ `src/lib/env.ts` â€” æ·»åŠ  `SENTRY_DSN` å’Œ `SENTRY_AUTH_TOKEN` å˜é‡

---

### Task #3 â€” GitHub Actions CI/CD æµæ°´çº¿

**å®¡è®¡ç»“æœ: âœ… é€šè¿‡**

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| å·¥ä½œæµæ–‡ä»¶ | âœ… | `.github/workflows/ci.yml` å­˜åœ¨ |
| è§¦å‘æ¡ä»¶ | âœ… | push/PR to `master` |
| Lint é˜¶æ®µ | âœ… | `pnpm lint` (ESLint) |
| ç±»å‹æ£€æŸ¥ | âœ… | `tsc --noEmit` |
| æµ‹è¯•é˜¶æ®µ | âœ… | `pnpm test` (Vitest) |
| æ„å»ºé˜¶æ®µ | âœ… | `pnpm build`ï¼Œä¾èµ– lint/typecheck/test |
| ç¯å¢ƒå˜é‡ | âœ… | `SKIP_ENV_VALIDATION=true` + mock å¿…éœ€å˜é‡ |
| åŒ…ç®¡ç†å™¨ | âœ… | pnpm v9 + `--frozen-lockfile` |
| Node ç‰ˆæœ¬ | âœ… | Node.js 20 |
| ç¼“å­˜ | âœ… | pnpm ç¼“å­˜å¯ç”¨ |

**å·²åˆ›å»ºçš„æ–‡ä»¶**:
- `.github/workflows/ci.yml` â€” 4 é˜¶æ®µæµæ°´çº¿ï¼ˆlint â†’ typecheck â†’ test â†’ buildï¼‰

**æµæ°´çº¿æ¶æ„**:
```
lint â”€â”€â”
       â”œâ”€â”€â†’ build (éœ€å…¨éƒ¨é€šè¿‡)
test â”€â”€â”¤
       â”‚
typecheck â”€â”˜
```

**æ³¨æ„äº‹é¡¹**:
- æ— è‡ªåŠ¨éƒ¨ç½²é˜¶æ®µï¼ˆdeployï¼‰ï¼Œå½“å‰ä»…åš CI éªŒè¯
- æ„å»ºé˜¶æ®µä½¿ç”¨ mock ç¯å¢ƒå˜é‡ç»•è¿‡ t3-env æ ¡éªŒï¼Œè®¾è®¡åˆç†
- å»ºè®®åç»­æ·»åŠ  Vercel/å…¶ä»–å¹³å°è‡ªåŠ¨éƒ¨ç½²æ­¥éª¤

---

### Task #4 â€” Resend é‚®ä»¶ç³»ç»Ÿ

**å®¡è®¡ç»“æœ: âœ… é€šè¿‡**

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| ä¾èµ–å®‰è£… | âœ… | `resend` v6.9.1 + `@react-email/components` v1.0.7 |
| é‚®ä»¶æœåŠ¡ | âœ… | `src/lib/email/index.ts` â€” 3 ä¸ªå‘é€å‡½æ•° |
| æ¬¢è¿é‚®ä»¶æ¨¡æ¿ | âœ… | `src/lib/email/templates/welcome.tsx` |
| æ”¯ä»˜å›æ‰§æ¨¡æ¿ | âœ… | `src/lib/email/templates/payment-receipt.tsx` |
| ç§¯åˆ†ä¸è¶³æ¨¡æ¿ | âœ… | `src/lib/email/templates/credits-low.tsx` |
| API è·¯ç”± | âœ… | `src/app/api/email/send/route.ts` |
| è®¤è¯é›†æˆ | âœ… | `src/lib/auth.ts` signIn å›è°ƒä¸­å¼‚æ­¥å‘é€æ¬¢è¿é‚®ä»¶ |
| ç¯å¢ƒå˜é‡ | âœ… | `RESEND_API_KEY` + `EMAIL_FROM` åœ¨ `env.ts` ä¸­å®šä¹‰ |
| é™çº§å¤„ç† | âœ… | æœªé…ç½® RESEND_API_KEY æ—¶ä¼˜é›…è·³è¿‡ |
| éé˜»å¡è®¾è®¡ | âœ… | é‚®ä»¶å‘é€å¤±è´¥ä¸å½±å“ç™»å½•æµç¨‹ |

**å·²åˆ›å»ºçš„æ–‡ä»¶**:
- `src/lib/email/index.ts` â€” ä¸»æœåŠ¡ï¼ˆ`sendWelcomeEmail`ã€`sendPaymentReceiptEmail`ã€`sendCreditsLowEmail`ï¼‰
- `src/lib/email/templates/welcome.tsx` â€” æš—è‰²ä¸»é¢˜ï¼Œç´«è‰² CTA æŒ‰é’®ï¼ŒæåŠ 100 å…è´¹ç§¯åˆ†
- `src/lib/email/templates/payment-receipt.tsx` â€” å›½é™…åŒ–è´§å¸æ ¼å¼ï¼Œè®¢å•è¯¦æƒ…å¡ç‰‡
- `src/lib/email/templates/credits-low.tsx` â€” ç¥ç€è‰²è­¦å‘Šæ ·å¼ï¼Œå‰©ä½™ç§¯åˆ†æ˜¾ç¤º
- `src/app/api/email/send/route.ts` â€” å†…éƒ¨é‚®ä»¶ APIï¼ˆ`x-api-key` æˆ– session è®¤è¯ï¼‰

**é›†æˆç‚¹**:
- æ–°ç”¨æˆ·æ³¨å†Œæ—¶åœ¨ `src/lib/auth.ts` çš„ `signIn` å›è°ƒä¸­è§¦å‘ `sendWelcomeEmail()`
- ä½¿ç”¨ `import()` åŠ¨æ€å¯¼å…¥ + `.catch()` ç¡®ä¿éé˜»å¡

---

### Task #5 â€” t3-env ç¯å¢ƒå˜é‡æ ¡éªŒ

**å®¡è®¡ç»“æœ: âœ… é€šè¿‡**

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| ä¾èµ–å®‰è£… | âœ… | `@t3-oss/env-nextjs` v0.13.10 + `zod` v4.3.6 |
| é…ç½®æ–‡ä»¶ | âœ… | `src/lib/env.ts` å®Œæ•´å®šä¹‰ |
| æœåŠ¡ç«¯å˜é‡ | âœ… | 34 ä¸ªå˜é‡ï¼ˆå«å¿…å¡« + å¯é€‰ï¼‰ |
| å®¢æˆ·ç«¯å˜é‡ | âœ… | 22 ä¸ª `NEXT_PUBLIC_*` å˜é‡ |
| è¿è¡Œæ—¶æ˜ å°„ | âœ… | `runtimeEnv` å…¨éƒ¨å˜é‡æ˜ å°„å®Œæ•´ |
| å¯åŠ¨æ ¡éªŒ | âœ… | `layout.tsx` ä¸­ `import "@/lib/env"` è§¦å‘ |
| CI è·³è¿‡ | âœ… | `SKIP_ENV_VALIDATION` æ”¯æŒ |
| ç©ºå­—ç¬¦ä¸²å¤„ç† | âœ… | `emptyStringAsUndefined: true` |

**å·²åˆ›å»º/ä¿®æ”¹çš„æ–‡ä»¶**:
- `src/lib/env.ts` â€” å®Œæ•´çš„ t3-env é…ç½®
- `src/app/layout.tsx` â€” æ·»åŠ å¯åŠ¨æ ¡éªŒ import
- `src/lib/supabase/server.ts` â€” ä» `process.env` è¿ç§»åˆ° `env.XXX`
- `src/lib/email/index.ts` â€” ä» `process.env` è¿ç§»åˆ° `env.XXX`
- `src/app/api/health/route.ts` â€” ä» `process.env` è¿ç§»åˆ° `env.XXX`

**å˜é‡åˆ†ç±»**:
- æ ¸å¿ƒå¿…å¡«ï¼ˆå¯åŠ¨æ—¶æ ¡éªŒï¼‰: `FAL_KEY`ã€`SUPABASE_SERVICE_ROLE_KEY`ã€`NEXTAUTH_URL`ã€`NEXTAUTH_SECRET`ã€`GOOGLE_ID`ã€`GOOGLE_SECRET`ã€`NEXT_PUBLIC_SUPABASE_URL`ã€`NEXT_PUBLIC_SUPABASE_ANON_KEY`
- åŠŸèƒ½å¯é€‰ï¼ˆç¼ºå¤±æ—¶åŠŸèƒ½é™çº§ï¼‰: R2 å­˜å‚¨ã€Stripeã€Creemã€Turnstileã€å†…å®¹å®‰å…¨ã€é‚®ä»¶ã€åˆ†æç­‰

**æ³¨æ„äº‹é¡¹**:
- å¹¶éæ‰€æœ‰æ–‡ä»¶éƒ½å·²ä» `process.env` è¿ç§»åˆ° `env.XXX`ï¼Œéƒ¨åˆ†éæ ¸å¿ƒæ–‡ä»¶ä»ç›´æ¥ä½¿ç”¨ `process.env`
- å»ºè®®åç»­é€æ­¥å°†å‰©ä½™æ–‡ä»¶è¿ç§»åˆ°ç±»å‹å®‰å…¨çš„ `env` å¼•ç”¨

---

### Task #6 â€” å¥åº·æ£€æŸ¥ç«¯ç‚¹

**å®¡è®¡ç»“æœ: âœ… é€šè¿‡**

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| API è·¯ç”± | âœ… | `src/app/api/health/route.ts` |
| æ•°æ®åº“æ£€æŸ¥ | âœ… | Supabase æŸ¥è¯¢è¿é€šæ€§æµ‹è¯• |
| AI æœåŠ¡æ£€æŸ¥ | âœ… | Fal.ai API å¯è¾¾æ€§æ£€æŸ¥ï¼ˆHEAD è¯·æ±‚ï¼‰ |
| å­˜å‚¨æ£€æŸ¥ | âœ… | R2 å…¬å…± URL å¯è¾¾æ€§æ£€æŸ¥ |
| å¹¶è¡Œæ‰§è¡Œ | âœ… | `Promise.all()` å¹¶è¡Œæ£€æŸ¥ |
| è¶…æ—¶ä¿æŠ¤ | âœ… | `AbortSignal.timeout(5000)` |
| çŠ¶æ€åˆ†çº§ | âœ… | `ok` / `degraded` / `error` ä¸‰çº§ |
| æ ¸å¿ƒä¾èµ–åˆ¤å®š | âœ… | æ•°æ®åº“å¼‚å¸¸ = HTTP 503ï¼Œå…¶ä»– = HTTP 200 degraded |
| ç³»ç»Ÿä¿¡æ¯ | âœ… | Node ç‰ˆæœ¬ã€å¹³å°ã€å†…å­˜ä½¿ç”¨ã€è¿è¡Œæ—¶é—´ |
| ç¼“å­˜æ§åˆ¶ | âœ… | `no-cache, no-store, must-revalidate` |
| ç±»å‹å®‰å…¨ | âœ… | ä½¿ç”¨ `env.XXX` è€Œé `process.env` |

**å·²åˆ›å»ºçš„æ–‡ä»¶**:
- `src/app/api/health/route.ts` â€” å®Œæ•´çš„å¥åº·æ£€æŸ¥ GET ç«¯ç‚¹

**å“åº”ç»“æ„**:
```json
{
  "status": "ok | degraded | error",
  "checks": {
    "database": { "name": "database", "status": "ok", "latency": 42 },
    "fal_ai": { "name": "fal_ai", "status": "ok", "latency": 120 },
    "r2_storage": { "name": "r2_storage", "status": "ok", "latency": 85 }
  },
  "timestamp": "ISO8601",
  "version": "0.1.0",
  "uptime": 3600,
  "system": { "nodeVersion": "...", "platform": "...", "memoryUsage": {...} }
}
```

---

### Task #7 â€” Pino ç»“æ„åŒ–æ—¥å¿— + Upstash åˆ†å¸ƒå¼é€Ÿç‡é™åˆ¶

**å®¡è®¡ç»“æœ: âœ… é€šè¿‡**

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| Pino é…ç½® | âœ… | `src/lib/logger.ts` â€” ç”Ÿäº§ JSON / å¼€å‘ pretty-print |
| å­æ—¥å¿—å™¨ | âœ… | 5 ä¸ªæ¨¡å—çº§å­ loggerï¼ˆauth, payment, flux-kontext, rate-limit, apiï¼‰ |
| æµ‹è¯•é™é»˜ | âœ… | `NODE_ENV=test` æ—¶ level ä¸º `silent` |
| Upstash é€Ÿç‡é™åˆ¶ | âœ… | `src/lib/rate-limit.ts` â€” 3 çº§æ»‘åŠ¨çª—å£ |
| å†…å­˜å›é€€ | âœ… | Upstash æœªé…ç½®æˆ–å¼‚å¸¸æ—¶è‡ªåŠ¨å›é€€åˆ°å†…å­˜ Map |
| ç»Ÿä¸€æ¥å£ | âœ… | `checkRateLimit(identifier, tier)` ç»Ÿä¸€å…¥å£ |
| ä¸­é—´ä»¶é›†æˆ | âœ… | `middleware.ts` ä¸­å¯¹ `/api/` è·¯ç”±è‡ªåŠ¨é™é€Ÿ |
| æ—¥å¿—é›†æˆ | âœ… | é€Ÿç‡é™åˆ¶æ¨¡å—ä½¿ç”¨ `rateLimitLogger` å­æ—¥å¿—å™¨ |

**å·²åˆ›å»ºçš„æ–‡ä»¶**:
- `src/lib/logger.ts` â€” Pino æ—¥å¿—é…ç½® + 5 ä¸ªå­æ—¥å¿—å™¨
- `src/lib/rate-limit.ts` â€” Upstash åˆ†å¸ƒå¼é™é€Ÿ + å†…å­˜å›é€€

**é€Ÿç‡é™åˆ¶ç­–ç•¥**:

| å±‚çº§ | é™åˆ¶ | çª—å£ | ç”¨é€” |
|------|------|------|------|
| `api` | 10 æ¬¡ | 60 ç§’ | é€šç”¨ API è¯·æ±‚ |
| `auth` | 5 æ¬¡ | 300 ç§’ | ç™»å½•/æ³¨å†Œ |
| `payment` | 3 æ¬¡ | 600 ç§’ | æ”¯ä»˜æ“ä½œ |

**ä¸­é—´ä»¶åŠŸèƒ½**ï¼ˆ`middleware.ts`ï¼‰:
- HTTPS é‡å®šå‘
- API v1 è·¯ç”±é‡å†™
- å®‰å…¨å¤´ï¼ˆCSPã€HSTSã€X-Frame-Options ç­‰ï¼‰
- é€Ÿç‡é™åˆ¶è‡ªåŠ¨åº”ç”¨äº `/api/` è·¯ç”±

---

### Task #8 â€” ç®¡ç†åå°é¢æ¿

**å®¡è®¡ç»“æœ: âœ… é€šè¿‡**

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| å¸ƒå±€ç»„ä»¶ | âœ… | `src/app/admin/layout.tsx` â€” æœåŠ¡ç«¯è®¤è¯ + å¯¼èˆªæ  |
| ä»ªè¡¨ç›˜ | âœ… | `src/app/admin/page.tsx` â€” 5 é¡¹ç»Ÿè®¡å¡ç‰‡ + è¿‘æœŸæ•°æ® |
| ç”¨æˆ·ç®¡ç† | âœ… | `src/app/admin/users/page.tsx` â€” æœç´¢/åˆ†é¡µ/ç§¯åˆ†ç¼–è¾‘ |
| è®¢å•ç®¡ç† | âœ… | `src/app/admin/orders/page.tsx` â€” çŠ¶æ€ç­›é€‰/åˆ†é¡µ |
| ç³»ç»Ÿè®¾ç½® | âœ… | `src/app/admin/settings/page.tsx` â€” å¥åº·æ£€æŸ¥ + æ”¯ä»˜å¼€å…³ |
| Dashboard API | âœ… | `src/app/api/admin/dashboard/route.ts` â€” å¹¶è¡Œç»Ÿè®¡æŸ¥è¯¢ |
| Users API | âœ… | `src/app/api/admin/users/route.ts` â€” GET åˆ—è¡¨ + PATCH ç§¯åˆ† |
| Orders API | âœ… | `src/app/api/admin/orders/route.ts` â€” GET åˆ—è¡¨ + çŠ¶æ€ç­›é€‰ |
| æƒé™éªŒè¯ | âœ… | `ADMIN_EMAILS` ç¯å¢ƒå˜é‡æ§åˆ¶ + åŒå±‚éªŒè¯ï¼ˆlayout + APIï¼‰ |
| UI é£æ ¼ | âœ… | æš—è‰²ä¸»é¢˜ï¼Œä¸é¡¹ç›®æ•´ä½“ä¸€è‡´ |

**å·²åˆ›å»ºçš„æ–‡ä»¶**:
- `src/app/admin/layout.tsx` â€” æœåŠ¡ç«¯ admin éªŒè¯ + ä¾§è¾¹å¯¼èˆª
- `src/app/admin/page.tsx` â€” ä»ªè¡¨ç›˜ï¼ˆæ€»ç”¨æˆ·/ä»˜è´¹ç”¨æˆ·/æ€»è®¢å•/æ€»æ”¶å…¥/æ€»ç§¯åˆ†æ¶ˆè€—ï¼‰
- `src/app/admin/users/page.tsx` â€” ç”¨æˆ·åˆ—è¡¨ï¼ˆé‚®ç®±æœç´¢ã€ç§¯åˆ†åœ¨çº¿ä¿®æ”¹ï¼‰
- `src/app/admin/orders/page.tsx` â€” è®¢å•åˆ—è¡¨ï¼ˆæŒ‰çŠ¶æ€ç­›é€‰ï¼‰
- `src/app/admin/settings/page.tsx` â€” ç³»ç»Ÿè®¾ç½®ï¼ˆå¥åº·çŠ¶æ€ã€åŠŸèƒ½å¼€å…³ã€ç»´æŠ¤æ¨¡å¼ï¼‰
- `src/app/api/admin/dashboard/route.ts` â€” ä»ªè¡¨ç›˜æ•°æ® API
- `src/app/api/admin/users/route.ts` â€” ç”¨æˆ·ç®¡ç† APIï¼ˆGET + PATCHï¼‰
- `src/app/api/admin/orders/route.ts` â€” è®¢å•ç®¡ç† APIï¼ˆGETï¼‰

**å®‰å…¨è®¾è®¡**:
- Layout å±‚ï¼šæœåŠ¡ç«¯ `getServerSession()` â†’ éªŒè¯é‚®ç®±åœ¨ `ADMIN_EMAILS` åˆ—è¡¨ä¸­ â†’ å¦åˆ™ `redirect('/')`
- API å±‚ï¼šæ¯ä¸ª API è·¯ç”±ç‹¬ç«‹éªŒè¯ admin èº«ä»½ï¼Œé˜²æ­¢ç»•è¿‡ layout ç›´æ¥è°ƒç”¨ API

---

## å‘ç°çš„é—®é¢˜å’Œç¼ºå¤±é¡¹

### é«˜ä¼˜å…ˆçº§é—®é¢˜

| # | é—®é¢˜ | å½±å“ | å»ºè®® |
|---|------|------|------|
| 1 | **Sentry æœªå®æ–½** | ç”Ÿäº§ç¯å¢ƒé”™è¯¯æ— æ³•è¿½è¸ª | å°½å¿«å®Œæˆ Task #2ï¼Œåˆ›å»ºæ‰€æœ‰é…ç½®æ–‡ä»¶ |
| 2 | **env.ts è¿ç§»ä¸å®Œæ•´** | éƒ¨åˆ†æ–‡ä»¶ä»ä½¿ç”¨ `process.env`ï¼Œæœªäº«å—ç±»å‹å®‰å…¨ | é€æ­¥å°† `middleware.ts`ã€`rate-limit.ts`ã€`admin/*` ç­‰è¿ç§»åˆ° `env.XXX` |
| 3 | **CI æ— è‡ªåŠ¨éƒ¨ç½²** | ä»£ç åˆå¹¶åä»éœ€æ‰‹åŠ¨éƒ¨ç½² | æ·»åŠ  Vercel éƒ¨ç½²æ­¥éª¤æˆ– deploy job |

### ä¸­ä¼˜å…ˆçº§é—®é¢˜

| # | é—®é¢˜ | å½±å“ | å»ºè®® |
|---|------|------|------|
| 4 | æµ‹è¯•è¦†ç›–ç‡æœ‰é™ | ä»… 3 ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œæ—  API è·¯ç”±/ç»„ä»¶æµ‹è¯• | æ·»åŠ  API è·¯ç”±é›†æˆæµ‹è¯•å’Œå…³é”®ç»„ä»¶æµ‹è¯• |
| 5 | æ—  E2E æµ‹è¯• | ç”¨æˆ·æ ¸å¿ƒæµç¨‹æœªè‡ªåŠ¨åŒ–éªŒè¯ | å¼•å…¥ Playwrightï¼Œè¦†ç›–ç™»å½•â†’ç”Ÿæˆâ†’æ”¯ä»˜æ ¸å¿ƒé“¾è·¯ |
| 6 | Admin é¢æ¿æ— å›½é™…åŒ– | ç®¡ç†åå°ä»…è‹±æ–‡ | å¦‚éœ€è¦å¯æ‰©å±• i18n æ”¯æŒ |
| 7 | `rate-limit.ts` ç›´æ¥ä½¿ç”¨ `process.env` | ä¸ t3-env ä½“ç³»ä¸ä¸€è‡´ | å°† `UPSTASH_REDIS_REST_URL/TOKEN` æ·»åŠ åˆ° `env.ts` |

### ä½ä¼˜å…ˆçº§é—®é¢˜

| # | é—®é¢˜ | å½±å“ | å»ºè®® |
|---|------|------|------|
| 8 | é‚®ä»¶æ¨¡æ¿ç¡¬ç¼–ç é“¾æ¥ | éƒ¨ç½²åˆ°ä¸åŒåŸŸåéœ€æ‰‹åŠ¨ä¿®æ”¹ | æ”¹ç”¨ `env.NEXT_PUBLIC_SITE_URL` åŠ¨æ€ç”Ÿæˆé“¾æ¥ |
| 9 | Health check æ— è®¤è¯ | ä»»ä½•äººå¯æ¢æµ‹ç³»ç»ŸçŠ¶æ€ | è€ƒè™‘æ·»åŠ ç®€å• token éªŒè¯æˆ–é™åˆ¶è®¿é—®é¢‘ç‡ |

---

## ä»å¾…å®æ–½çš„åŠŸèƒ½æ¸…å•

### æ¥è‡ªç¬¬äºŒé˜¶æ®µï¼ˆç”Ÿäº§å°±ç»ªï¼‰

| åŠŸèƒ½ | Gap Analysis çŠ¶æ€ | å½“å‰å®æ–½çŠ¶æ€ |
|------|-------------------|-------------|
| åˆ†å¸ƒå¼é€Ÿç‡é™åˆ¶ | ğŸ”´ é«˜ | âœ… å·²å®Œæˆï¼ˆTask #7ï¼‰ |
| ç»“æ„åŒ–æ—¥å¿— | ğŸ”´ é«˜ | âœ… å·²å®Œæˆï¼ˆTask #7ï¼‰ |
| ç®¡ç†åå° | ğŸ”´ é«˜ | âœ… å·²å®Œæˆï¼ˆTask #8ï¼‰ |
| **2FA / MFA** | ğŸŸ¡ ä¸­ | âŒ æœªå¼€å§‹ |
| **Docker æ”¯æŒ** | ğŸŸ¡ ä¸­ | âŒ æœªå¼€å§‹ |
| **æ•°æ®åº“è¿ç§»ç®¡ç†** | ğŸŸ¡ ä¸­ | âŒ æœªå¼€å§‹ |

### æ¥è‡ªç¬¬ä¸‰é˜¶æ®µï¼ˆç”¨æˆ·ä½“éªŒï¼‰

| åŠŸèƒ½ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|------|--------|------|
| ç”¨æˆ·è®¾ç½®é¡µ | ğŸ”´ é«˜ | âŒ æœªå¼€å§‹ |
| è´¦å•ç®¡ç†é—¨æˆ· | ğŸ”´ é«˜ | âŒ æœªå¼€å§‹ |
| æ–°æ‰‹å¼•å¯¼æµç¨‹ | ğŸŸ¡ ä¸­ | âŒ æœªå¼€å§‹ |
| é€šçŸ¥ç³»ç»Ÿ | ğŸŸ¡ ä¸­ | âŒ æœªå¼€å§‹ |
| Cookie åŒæ„æ¨ªå¹… | ğŸŸ¡ ä¸­ | âŒ æœªå¼€å§‹ |
| åé¦ˆ/å·¥å•ç³»ç»Ÿ | ğŸŸ¡ ä¸­ | âŒ æœªå¼€å§‹ |
| ç”¨æˆ·æ•°æ®å¯¼å‡º (GDPR) | ğŸŸ¡ ä¸­ | âŒ æœªå¼€å§‹ |

### æ¥è‡ªç¬¬å››é˜¶æ®µï¼ˆå¢é•¿ä¸è§„æ¨¡åŒ–ï¼‰

| åŠŸèƒ½ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|------|--------|------|
| å›¢é˜Ÿ/ç»„ç»‡æ”¯æŒ | ğŸŸ¡ ä¸­ | âŒ æœªå¼€å§‹ |
| ç”¨é‡åˆ†æé¢æ¿ | ğŸŸ¡ ä¸­ | âŒ æœªå¼€å§‹ |
| åå°ä»»åŠ¡é˜Ÿåˆ— | ğŸŸ¡ ä¸­ | âŒ æœªå¼€å§‹ |
| Feature Flags | ğŸŸ¢ ä½ | âŒ æœªå¼€å§‹ |
| åšå®¢ / CMS | ğŸŸ¢ ä½ | âŒ æœªå¼€å§‹ |
| Changelog | ğŸŸ¢ ä½ | âŒ æœªå¼€å§‹ |
| å®¡è®¡æ—¥å¿— | ğŸŸ¢ ä½ | âŒ æœªå¼€å§‹ |
| API Key ç®¡ç† UI | ğŸŸ¢ ä½ | âŒ æœªå¼€å§‹ |
| æ›´å¤š OAuth æä¾›å•† | ğŸŸ¢ ä½ | âŒ æœªå¼€å§‹ |

---

## ä¸‹ä¸€æ­¥å»ºè®®

### ç´§æ€¥ï¼ˆæœ¬å‘¨å†…ï¼‰

1. **å®Œæˆ Sentry é›†æˆ**ï¼ˆTask #2ï¼‰
   - åˆ›å»º `sentry.client.config.ts`ã€`sentry.server.config.ts`ã€`sentry.edge.config.ts`
   - æ·»åŠ  `src/app/global-error.tsx` å…¨å±€é”™è¯¯è¾¹ç•Œ
   - ä¿®æ”¹ `next.config.ts` åŒ…è£¹ `withSentryConfig`
   - åœ¨ `env.ts` ä¸­æ·»åŠ  `SENTRY_DSN` å˜é‡

2. **å®Œå–„ env.ts è¿ç§»**
   - å°† `UPSTASH_REDIS_REST_URL`ã€`UPSTASH_REDIS_REST_TOKEN` æ·»åŠ åˆ° `env.ts`
   - è¿ç§» `middleware.ts`ã€`rate-limit.ts` åˆ°ç±»å‹å®‰å…¨å¼•ç”¨

### çŸ­æœŸï¼ˆ1-2 å‘¨ï¼‰

3. **æ‰©å±•æµ‹è¯•è¦†ç›–**
   - ä¸ºé‚®ä»¶æœåŠ¡ã€å¥åº·æ£€æŸ¥ã€ç®¡ç† API æ·»åŠ å•å…ƒæµ‹è¯•
   - ä¸ºæ ¸å¿ƒç”¨æˆ·æµç¨‹æ·»åŠ  Playwright E2E æµ‹è¯•

4. **CI æµæ°´çº¿å¢å¼º**
   - æ·»åŠ è‡ªåŠ¨éƒ¨ç½²æ­¥éª¤ï¼ˆVercel preview + productionï¼‰
   - æ·»åŠ è¦†ç›–ç‡æŠ¥å‘Šä¸Šä¼ ï¼ˆCodecovï¼‰

### ä¸­æœŸï¼ˆ2-4 å‘¨ï¼‰

5. **å¯åŠ¨ç¬¬ä¸‰é˜¶æ®µç”¨æˆ·ä½“éªŒæ¨¡å—**
   - ä¼˜å…ˆå®ç°ç”¨æˆ·è®¾ç½®é¡µå’Œè´¦å•ç®¡ç†é—¨æˆ·
   - æ·»åŠ  Cookie åŒæ„æ¨ªå¹…ï¼ˆGDPR åˆè§„ï¼‰

6. **Docker æ”¯æŒ**
   - æ·»åŠ å¤šé˜¶æ®µæ„å»º Dockerfile
   - æ·»åŠ  docker-compose.ymlï¼ˆå¼€å‘ç¯å¢ƒï¼‰

---

## å®Œå¤‡åº¦è¯„ä¼°æ›´æ–°

| é˜¶æ®µ | åŸè¯„ä¼° | å½“å‰å®Œæˆåº¦ |
|------|--------|-----------|
| ç¬¬ä¸€é˜¶æ®µï¼ˆåŸºç¡€è®¾æ–½ï¼‰ | 0/6 | **5/6**ï¼ˆSentry æœªå®Œæˆï¼‰ |
| ç¬¬äºŒé˜¶æ®µï¼ˆç”Ÿäº§å°±ç»ªï¼‰ | 0/6 | **3/6**ï¼ˆæ—¥å¿—+é™é€Ÿ+ç®¡ç†åå°å·²å®Œæˆï¼‰ |
| ç¬¬ä¸‰é˜¶æ®µï¼ˆç”¨æˆ·ä½“éªŒï¼‰ | 0/7 | **0/7** |
| ç¬¬å››é˜¶æ®µï¼ˆå¢é•¿è§„æ¨¡åŒ–ï¼‰ | 0/9 | **0/9** |

**æ•´ä½“å®Œå¤‡åº¦**: ä»åŸå§‹çš„ ~25-30% æå‡è‡³çº¦ **45-50%**ã€‚ç¬¬ä¸€é˜¶æ®µåŸºç¡€è®¾æ–½åŸºæœ¬å°±ç»ªï¼Œé¡¹ç›®å·²æ¥è¿‘ã€Œå¯ä¸Šç”Ÿäº§ã€æ ‡å‡†ã€‚
